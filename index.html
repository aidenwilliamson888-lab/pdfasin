<script>
document.addEventListener('DOMContentLoaded', function () {

  /* ================= ELEMENTS ================= */
  const openPdf = document.getElementById('openPdf');
  const bookTitle = document.getElementById('bookTitle');
  const ratingValue = document.getElementById('ratingValue');
  const downloadCount = document.getElementById('downloadCount');
  const adBanner = document.getElementById('adBanner');
  const cover = document.getElementById('bookCover');
  const reviewEls = document.querySelectorAll('.review');

  /* ================= PARAM ================= */
  const params = new URLSearchParams(window.location.search);
  const ASIN = params.get('filepdf') || 'B0XXXXXXX';

  /* ================= IMAGE FROM ASIN ================= */
  const amazonImage = `https://images-na.ssl-images-amazon.com/images/P/${ASIN}.01.LZZZZZZZ.jpg`;
  cover.loading = 'lazy';
  cover.decoding = 'async';
  cover.src = amazonImage;
  cover.onerror = () => cover.src = 'images/placeholder.jpg';

  /* ================= PDF ================= */
  const pdfUrl = '/filebookpdf.pdf';

  /* ================= TITLE & STATS ================= */
  bookTitle.textContent = 'PDF Download (' + ASIN + ')';
  ratingValue.textContent = (Math.random() * 0.3 + 4.6).toFixed(1);
  downloadCount.textContent = (Math.floor(Math.random() * 1200) + 100).toLocaleString();

  /* ================= REVIEW DATA ================= */
  const names = [
    'Alex M.', 'Sarah K.', 'Daniel R.', 'Emily T.',
    'Michael B.', 'Jessica L.', 'Ryan P.', 'Olivia S.'
  ];

  const reviews = [
    'Very actionable and easy to understand.',
    'High quality content, worth reading.',
    'Clear explanations and practical tips.',
    'Concise, helpful, and easy to follow.',
    'Great reference material, highly recommended.'
  ];

  /* ================= HELPERS ================= */
  function shuffle(arr) {
    return arr.sort(() => Math.random() - 0.5);
  }

  function randomDaysAgo() {
    return Math.floor(Math.random() * 7) + 1; // 1–7 days ago
  }

  shuffle(names);
  shuffle(reviews);

  /* ================= RENDER 3 REVIEWS ================= */
  reviewEls.forEach((el, i) => {
    if (i < 3) {
      const days = randomDaysAgo();
      el.style.display = 'block';
      el.innerHTML = `
        <strong>${names[i]}</strong>
        <span style="font-size:11px;color:#6b7280;"> · ${days} days ago</span><br>
        “${reviews[i]}”<br>
        <span style="color:#f59e0b;">★★★★★</span>
        <span style="font-size:11px;color:#16a34a;"> Verified Reader</span>
      `;
    } else {
      el.style.display = 'none';
    }
  });

  /* ================= DOWNLOAD ================= */
  openPdf.addEventListener('click', () => {
    window.open(pdfUrl, '_blank', 'noopener,noreferrer');
  });

  /* ================= ADS ================= */
  function refreshAd() {
    const mobile = window.innerWidth < 500;
    adBanner.style.width = mobile ? '320px' : '480px';
    adBanner.style.height = mobile ? '50px' : '60px';
    adBanner.textContent = mobile ? 'Ad 320x50' : 'Ad 480x60';
  }

  refreshAd();
  window.addEventListener('resize', refreshAd);
  setInterval(refreshAd, 15000);

  /* ================= BASIC PROTECTION ================= */
  document.addEventListener('contextmenu', e => e.preventDefault());
  document.addEventListener('keydown', e => {
    if ((e.ctrlKey || e.metaKey) && ['s', 'p'].includes(e.key.toLowerCase())) {
      e.preventDefault();
    }
  });

});
</script>
